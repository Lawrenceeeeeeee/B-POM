from openai import OpenAI
import os
import json
import numpy as np
from dotenv import load_dotenv


# è·å–å½“å‰å‡½æ•°æ‰€åœ¨æ–‡ä»¶çš„ç›®å½•
current_dir = os.path.dirname(os.path.abspath(__file__))
# ä¿å­˜åŸå§‹å·¥ä½œç›®å½•
original_cwd = os.getcwd()
# æ›´æ”¹å·¥ä½œç›®å½•åˆ°å‡½æ•°æ‰€åœ¨æ–‡ä»¶ç›®å½•
os.chdir(current_dir)
load_dotenv()

client = OpenAI(api_key=os.environ.get('CHATANYWHERE_API_KEY'), base_url="https://api.chatanywhere.tech/v1")
os.chdir(original_cwd)

def embedding(text, model="text-embedding-3-large"):

    response = client.embeddings.create(
        input=text,
        model=model
    )

    return np.array(response.data[0].embedding)

def cosine_similarity(A, B):
    dot_product = np.dot(A, B)
    norm_a = np.linalg.norm(A)
    norm_b = np.linalg.norm(B)
    return dot_product / (norm_a * norm_b)

if __name__ == "__main__":
    text = '''
    è¿™æ˜¯å…³äºæ·±åº¦å­¦ä¹ ä¸­ç¥ç»ç½‘ç»œç»“æ„çš„è§†é¢‘ã€‚è§†é¢‘ä¸­ä»‹ç»äº†ç¥ç»ç½‘ç»œçš„åŸºæœ¬ç»“æ„å’Œå¦‚ä½•è¯†åˆ«æ‰‹å†™æ•°å­—ã€‚é€šè¿‡è®²è§£è„‘ç»„ç»‡å’Œå±‚æ¬¡ä¹‹é—´çš„å…³ç³»ï¼Œå¸®åŠ©è§‚ä¼—ç†è§£ç¥ç»ç½‘ç»œçš„è¿ä½œåŸç†ã€‚

    ### äº®ç‚¹

    - ğŸ§  è„‘ç»„ç»‡åœ¨ç¥ç»ç½‘ç»œä¸­ä»£è¡¨æ•°å­—ï¼Œä¸åŒç»„ç»‡è´Ÿè´£ä¸åŒæ•°å­—çš„è¯†åˆ«ã€‚
    - ğŸ” ç¥ç»ç½‘ç»œé€šè¿‡ä¸åŒå±‚æ¬¡é—´çš„è¿æ¥è§£å†³é—®é¢˜ï¼Œç±»ä¼¼ç”Ÿç‰©è„‘ç»„ç»‡ä¸­çš„ä¿¡æ¯ä¼ é€’ã€‚
    - ğŸ¤– ç¥ç»å…ƒçš„è´¨é‡å’Œåå·®ï¼Œä»¥åŠSigmoidå‡½æ•°çš„ä½œç”¨åœ¨ç¥ç»ç½‘ç»œä¸­èµ·ç€é‡è¦ä½œç”¨ã€‚
    - ğŸ“Š æ‰‹åŠ¨è°ƒæ•´ç¥ç»ç½‘ç»œçš„æƒé‡å’Œåå·®ï¼Œèƒ½å¸®åŠ©ç†è§£ç½‘ç»œå¦‚ä½•å­¦ä¹ å’Œå†³ç­–ã€‚
    - ğŸ“š é€šè¿‡å›¾æ çš„æ–¹å¼è¡¨è¾¾ç¥ç»ç½‘ç»œçš„æƒé‡å’Œè¿æ¥ï¼Œç®€åŒ–äº†å¤æ‚çš„æ•°å­¦è¿ç®—ã€‚
    '''
    text2 = """
    å·ç§¯ç¥ç»ç½‘ç»œï¼Œæ“…é•¿å›¾åƒè¯†åˆ«ï¼›

é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼Œæ“…é•¿è¯­éŸ³è¯†åˆ«ã€‚

ç¥ç»å…ƒ:ä¸€ä¸ªè£…æœ‰æ•°å­—çš„å®¹å™¨ï¼Œé‡Œé¢çš„æ•°å­—æ˜¯ æ¿€æ´»å€¼ å…¶å€¼è¶Šå¤§è¯¥ç¥ç»å…ƒæ¿€æ´»çš„ç¨‹åº¦å°±è¶Šå¤§ã€‚æœ€åä¸€å±‚ç¥ç»å…ƒçš„æ¿€æ´»å€¼å¯ä»¥è®¤ä¸ºæ˜¯æ•´ä¸ªç¥ç»ç½‘ç»œè®¤ä¸ºæ˜¯è¯¥è¾“å‡ºå€¼çš„å¯èƒ½æ€§ï¼Œæ¿€æ´»å€¼è¶Šå¤§ï¼Œæ˜¯è¯¥å€¼çš„å¯èƒ½æ€§è¶Šå¤§ã€‚

éšå«å±‚:åšæ•°å­—è¯†åˆ«çš„å…·ä½“å·¥ä½œã€‚

ä¸Šä¸€å±‚çš„æ¿€æ´»å€¼å½±å“å¹¶å†³å®šä¸‹ä¸€å±‚çš„æ¿€æ´»å€¼ï¼Œæ‰€ä»¥ç¥ç»ç½‘ç»œçš„æ ¸å¿ƒå°±æ˜¯ä¸€å±‚çš„æ¿€æ´»å€¼é€šè¿‡æ€æ ·çš„è¿ç®—ï¼Œç®—å‡ºä¸‹ä¸€å±‚çš„æ¿€æ´»å€¼ã€‚

ä¸­é—´å±‚è®¡ç®—ç‰¹å¾ï¼Œå¹¶ç»„åˆç‰¹å¾ç„¶åè¾“å‡ºåˆ°è¾“å‡ºå±‚ï¼Œç”¨ä»¥è¾“å‡ºç›¸åº”çš„é¢„æµ‹å€¼ã€‚
    """
    similarity = cosine_similarity(embedding(text), embedding(text2))
    print(similarity)